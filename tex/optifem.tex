
In the last three Chapters we have introduced the most important six \PETSc object types:
\begin{itemize}
\item[\quad Chapter \ref{chap:ls}:] \pVec, \pMat, \pKSP, \pPC
\item[\quad Chapter \ref{chap:st}:] \pDM (in the \pDMDA case)
\item[\quad Chapter \ref{chap:ls}:] \pSNES
\end{itemize}
Each of the examples in the rest of this book will use all of these types in some way.

In particular, from now on we will solve \emph{linear} PDEs using a \pSNES object and Newton iteration, so as to get more uniform code structure.  Linear problems are simply the case where we know, in advance, that one Newton iteration suffices.

In the current Chapter we take a break from introducing new \PETSc objects, but we continue with new ideas.  Our one example from a significant class of nonlinear PDEs, namely a Poisson-like diffusion problem with solution-dependent diffusivity.  This example is an excuse to introduce PDE problems which are equivalent to minimization in a function space, and structured-grid finite element methods (FEM).


\section{$p$-Laplacian equation as minimization}

Let $\Omega$ be a domain (connected open subset) in $\RR^2$ or $\RR^3$ with well-behaved boundary.  Consider this nonlinear functional for $p \ge 1$,
\begin{equation}
    I[u] = \int_\Omega \frac{1}{p} |\grad u|^p - fu.  \label{eq:of:functional}
\end{equation}
This functional is well-defined on the Sobolev space of functions which are defined on $\Omega$, are integrable, and have an integrable gradient:
    $$W^{1,p}(\Omega) = \left\{f \,:\, \int_\Omega |f|^p < \infty \,\, \& \, \int_\Omega |\grad f|^p < \infty\right\}.$$
This is a Banach space with norm
    $$\|u\|_{W^{1,p}} = \left(\int_\Omega |f|^p + \int_\Omega |\grad f|^p\right)^{1/p}.$$

Not only is the functional $I[u]$ in \eqref{eq:of:functional} well-defined, it has a minimum, as suggested in our cartoon version in Figure \ref{fig:of:cartoonfunctional}.  First of all it is \emph{coercive} in the sense that if the norm of the input function is large then the output is large:
    $$\lim_{\|u\|_{W^{1,p}} \to \infty} I[u] = +\infty.$$
Furthermore the functional FIXME: IS CONVEX AND WELL-BEHAVED.  THUS IT HAS A MIN

\begin{marginfigure}
\begin{tikzpicture}
\begin{axis}[view={145}{45},
             axis lines=center,
             axis on top,
             xtick=\empty,ytick=\empty,ztick=\empty,
             xlabel=$W^{1,p}(\Omega)$,
             xlabel near ticks,
             xlabel shift={25pt},
             mesh/interior colormap name=blackwhite,
             colormap/blackwhite,]
  \addplot3[domain=-10:10,surf,opacity=0.5]{abs(x)^3 + abs(y)^3};
\end{axis}
\end{tikzpicture}
\medskip
\caption{FIXME}
\label{fig:of:cartoonfunctional}
\end{marginfigure}


the variational equation is the weak form of a PDE:
\begin{align*}
I[u+\eps v] - I[u] &= \int_\Omega \frac{1}{p} |\grad u + \eps \grad v|^p + \frac{1}{p} |\grad u|^p - \eps f v \\
   &= \eps \left(\int_\Omega |\grad u|^{p-2} \grad u \cdot \grad v - f v\right) + O(\eps^2)
\end{align*}
so we want
    $$0 = \int_\Omega |\grad u|^{p-2} \grad u \cdot \grad v - f v$$
for all $v \in W^{1,p}_0(\Omega)$.  this can become a strong form by another integration by parts,
    $$0 = - \Div\left(|\grad u|^{p-2} \grad u\right) - f$$
which is \eqref{poissonsquare} if $p=2$

\section{Structured $Q^1$ finite elements}

FIXME

\begin{marginfigure}
\input{q1hat.tikz}
\caption{FIXME}
\label{fig:q1hat}
\end{marginfigure}

FIXME code uses \texttt{SNESSetObjective()} only, though also \texttt{SNESSetFunction()}; no hand-made Jacobian at all

FIXME try NCG

\section{Implementation with objective only}

\cinputpart{plap.c}{\CODELOC}{FIXME I}{I}{//STARTCONFIGURE}{//ENDCONFIGURE}{code:plapI}

\cinputpart{plap.c}{\CODELOC}{FIXME II}{II}{//STARTEXACTF}{//ENDEXACTF}{code:plapII}

\cinputpart{plap.c}{\CODELOC}{FIXME III}{III}{//STARTOBJECTIVE}{//ENDOBJECTIVE}{code:plapIII}

\cinputpart{plap.c}{\CODELOC}{FIXME IV}{IV}{//STARTMAIN}{//ENDMAIN}{code:plapIV}


\section{Residual function $=$ gradient}

\cinputpart{plap.c}{\CODELOC}{FIXME V}{V}{//STARTFUNCTION}{//ENDFUNCTION}{code:plapV}


\section{Exercises}

\renewcommand{\labelenumi}{\arabic{chapter}.\arabic{enumi}\quad}
\renewcommand{\labelenumii}{(\alph{enumii})}
\begin{enumerate}
\item FIXME
\end{enumerate}