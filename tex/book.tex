\documentclass{tufte-book}

\hypersetup{colorlinks}

\usepackage{xspace}

\newcommand{\PETSCVERSION}{3.6\xspace}

\newcommand{\CODELOC}{}  % each Chapter redefines this

\let\STUBSONLY\relax  %                                <--- UNCOMMENT TO GENERATE STUB CHAPTERS
\ifx\STUBSONLY\undefined
  \newcommand{\stubinput}[2]{\input{#1}}
\else
  \newcommand{\stubinput}[2]{\vspace{5cm} \centerline{\LARGE Percent completed:  \Huge #2\%.} \vfill}
\fi

\renewcommand{\maketitlepage}[0]{%
  \cleardoublepage%
  {%
  \sffamily%
  \begin{fullwidth}%
  \fontsize{18}{20}\selectfont\par\noindent\textcolor{darkgray}{\allcaps{\thanklessauthor}}%
  \vspace{9pc}%
  \fontsize{32}{40}\selectfont\par\noindent\textcolor{darkgray}{\allcaps{\thanklesstitle}}%
  \vfill%
    \fontsize{18}{40}\selectfont\par\noindent\textcolor{darkgray}{\allcaps{numerical solutions in C using}}%
    \fontsize{18}{40}\selectfont\par\noindent\textcolor{darkgray}{\allcaps{the Portable, Extensible Toolkit for Scientific computation version \PETSCVERSION}}%
  \vfill%
  \fontsize{14}{16}\selectfont\par\noindent\allcaps{\thanklesspublisher}%
  \end{fullwidth}%
  }
  \thispagestyle{empty}%
  \clearpage%
}

\title[PETSc for PDEs]{PETSc \\ for \\ Partial \\ Differential \\ Equations}

\author{Ed Bueler}
\publisher{SIAM Press (contracted)}

\date{\today}

\usepackage{booktabs} % for nicely-typeset tabular material
\usepackage{verbatim} % for "comment" environment
%\usepackage{underscore} % causes "Missing \endcsname inserted" error?
\usepackage{graphicx}
\usepackage{amsmath,amssymb,amsthm,bm}

\usepackage{tikz}
\usetikzlibrary{arrows.meta,decorations.markings,decorations.pathreplacing,fadings}

\usepackage{pgfplots}

\usepackage{newfloat,caption}

\usepackage{fancyvrb}
% an alternative which does not seem to have "start string" and
% "stop string" capabilities:
%\usepackage{listings}

\newtheorem*{theorem}{Theorem}
\theoremstyle{definition}
\newtheorem*{example}{Example}
\newtheorem*{examplecont}{Example, continued}

% Prints an epigraph and speaker in sans serif, all-caps type.
\newcommand{\openepigraph}[2]{%
  %\sffamily\fontsize{14}{16}\selectfont
  \begin{fullwidth}
  \sffamily\large
  \begin{doublespace}
  \noindent\allcaps{#1}\\% epigraph
  \noindent \Large \allcaps{#2}% author
  \end{doublespace}
  \end{fullwidth}
}

\newcommand{\monthyear}{%
  \ifcase\month\or January\or February\or March\or April\or May\or June\or
  July\or August\or September\or October\or November\or
  December\fi\space\number\year
}

\input{macros.tex}

\setcounter{secnumdepth}{0}

% eventually this is a good idea:
%\usepackage{makeidx}
%\makeindex

\begin{document}

\begin{comment}
% epigraph page first
\newpage\thispagestyle{empty}
\openepigraph{%
\dots when there are disputes among persons, we can simply say: Let us calculate, without further ado, to see who is right.
}{Gottfried Wilhelm Leibniz}
\vfill
\openepigraph{%
Developing parallel, nontrivial PDE solvers that deliver high performance is still difficult and requires months (or even years) of concentrated effort.  PETSc is a toolkit that can ease these difficulties and reduce the development time, but it is not a black-box PDE solver, nor a silver bullet
}{Barry Smith}
\vfill
\openepigraph{%
Tufte's style is known for its extensive use of sidenotes, tight integration of graphics with text, and well-set typography.
}{The Tufte-LaTeX\ Developers}
\vfill

\frontmatter
\end{comment}

\maketitle


\newpage
\begin{fullwidth}
~\vfill
\thispagestyle{empty}
\setlength{\parindent}{0pt}
\setlength{\parskip}{\baselineskip}
Copyright \copyright\ \the\year\ \thanklessauthor

\par\smallcaps{To be published by SIAM Press}

\par\textit{Draft, \monthyear}
\end{fullwidth}

\tableofcontents


% Thanks to \mbox{Jed Brown} and \mbox{Constantine Khroulev}, fellow students, and gurus.


\chapter*{Preface}
\input{chaps/preface.tex}

\mainmatter

%\setcounter{chapter}{0}

\chapter{Getting started with PETSc}
\label{chap:gs}
\renewcommand{\CODELOC}{ch1/}
\input{chaps/getstarted.tex}

\chapter{Finite-dimensional linear systems}
\label{chap:ls}
\renewcommand{\CODELOC}{ch2/}
\input{chaps/linearsystem.tex}

\chapter{Poisson equation on a structured grid}
\label{chap:st}
\renewcommand{\CODELOC}{ch3/}
\input{chaps/structured.tex}

\chapter{Nonlinear equations}
\label{chap:nl}
\renewcommand{\CODELOC}{ch4/}
\input{chaps/nonlinear.tex}

\chapter{FEM example I: Nonlinear optimization}
\label{chap:of}
\renewcommand{\CODELOC}{ch5/}
\input{chaps/optifem.tex}

\chapter{Time-stepping, and systems of PDEs}
\label{chap:ts}
\renewcommand{\CODELOC}{ch6/}
%\stubinput{chaps/timesys.tex}{30}
\input{chaps/timesys.tex}

\chapter{Advection-diffusion equations}
\label{chap:ad}
\renewcommand{\CODELOC}{ch7/}
\stubinput{chaps/advdif.tex}{20}
%\input{chaps/advdif.tex}

\chapter{FEM example II: Unstructured mesh}
\label{chap:un}
\renewcommand{\CODELOC}{ch8/}
%\stubinput{chaps/unstructured.tex}{40}
\input{chaps/unstructured.tex}

\chapter{Preconditioners}
\label{chap:pr}
\renewcommand{\CODELOC}{ch9/}
\stubinput{chaps/precond.tex}{10}
%\input{chaps/precond.tex}

\chapter{Parallel scaling and performance}
\label{chap:sc}
\renewcommand{\CODELOC}{ch10/}
\stubinput{chaps/scaling.tex}{5}
%\input{chaps/scaling.tex}

\chapter{Stokes equations}
\label{chap:ok}
\renewcommand{\CODELOC}{ch11/}
\stubinput{chaps/stokes.tex}{5}
%\input{chaps/stokes.tex}

\chapter{Constraints and variational inequalities}
\label{chap:co}
\renewcommand{\CODELOC}{ch12/}
\stubinput{chaps/constrained.tex}{20}
%\input{chaps/constrained.tex}

\chapter{Unstructured meshes}
\label{chap:dp}
\renewcommand{\CODELOC}{ch13/}
\stubinput{chaps/dmplex.tex}{0}

%\chapter{Epilog}
%three slogans:
%  1. every problem is nonlinear
%  2. every computation is parallel
%  3. performance comes from good preconditioning
%there is no sense in which the book "covers" these; they are patterns which are clear in retrospect

%page = list of "facts of life"

%%%%%%%%%%

\backmatter

\bibliography{book}
\bibliographystyle{plainnat}

\clearpage

\newcommand{\tblockeqncode}[3]{
\begin{tabular}[t]{l} #1 \\ \quad {\normalsize \texttt{#3}} \\ \qquad \fbox{\small #2} \end{tabular}
}
\newcommand{\tblockcode}[2]{
\begin{tabular}[t]{l} #1 \\ \quad {\normalsize \texttt{#2}} \end{tabular}
}
\newcommand{\tblock}[1]{
\begin{tabular}[t]{l} #1 \end{tabular}
}


\clearpage
\thispagestyle{empty}
\noindent \textsc{inside front (or back) cover:}

{\large \noindent \textsc{PDE examples}.} \quad Chapter $N$ codes are in directory \texttt{c/ch}$N$\texttt{/}.

\medskip
\small
\begin{tabular}{lllll}
\toprule
Chapter
    &\multicolumn{1}{c}{linear\phantom{foo}}
          &\multicolumn{1}{c}{nonlinear}
                &\multicolumn{1}{c}{nonlinear time-dependent} \\
\midrule  \bigskip
\ref{chap:st}
    & \tblockeqncode{Poisson (2D)}{$-\grad^2 u = f$}{poisson.c}
          &     &      \\ \bigskip
\ref{chap:nl}
    &     & \tblockeqncode{diffusion-reaction (1D)}{$- u''-R(u)=f$}{reaction.c} &      \\ \bigskip
\ref{chap:of}
    &     & \tblockeqncode{$p$-Laplace (2D)}{$-\Div\left(|\grad u|^{p-2} \grad u\right) = f$}{plap.c}
                &  \\ \bigskip
\ref{chap:ts}
    & \tblockeqncode{time-dependent heat (2D)}{$u_t = \grad^2 u + f$}{heat.c}
          &     & \tblockeqncode{diffusion-reaction (2D))}{$\bu_t = \grad^2 \bu + \bR(\bu)$}{pattern.c} \\ \bigskip
\ref{chap:ad}
    &  \tblockeqncode{advection-diffusion (3D)}{$- \eps \grad^2 u + \bw \cdot \grad u = f$}{ad3.c}
          &     &      \\ \bigskip
\ref{chap:un}
    & \tblockcode{Poisson (2D)}{femfish.c}    &     &     &      \\ \bigskip
\ref{chap:pr}
    & \tblockcode{Poisson (2D)}{fish2.c}    &     &     &      \\ \bigskip
\ref{chap:sc}
    &     &     & \tblockeqncode{porous (3D)}{$u_t = \Div\left(u^{\gamma-1} \grad u\right) + f$}{porous.c} \\ \bigskip
\ref{chap:ok}
    & \tblockeqncode{Stokes (2D)}{$\begin{matrix} -\grad^2 \bu + \grad p = 0 \\ \Div \bu = 0 \end{matrix}$}{stokes.c}
          &     &      \\ \bigskip
\ref{chap:co}
    &     & \tblockeqncode{obstacle (2D)}{$\begin{matrix} -\grad^2 u = f \\ u\ge \psi \end{matrix}$}{obstacle.c}
                & \tblockeqncode{ice sheet (2D)}{$\begin{matrix} H_t = \Div\left(D \grad H\right) + f \\ D \text{ nonlinear},\, H \ge 0\end{matrix}$}{ice.c} \\ \bigskip
\ref{chap:dp}
    & \tblockcode{Poisson (2D, 3D)}{plexfish.c}
          &     &      \\
\bottomrule
\end{tabular}


\end{document}
