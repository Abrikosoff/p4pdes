
To the reader has become lost in the maze of issues which we have built around the examples so far---whether it is finite elements, line searches, Krylov solvers, preconditioner choices, or whatever causes the confusion---then now for some good news:  In \emph{this} Chapter we restart with an easy question and a small example.

Solving \emph{ordinary} differential equations (ODEs) with \PETSc should be easy.  It is, and so is making the transition, through spatial discretization, to numerical methods for time-dependent, parabolic PDEs like the heat equation.  In this Chapter we look at three examples, a scalar ODE, a system of ODEs arising from finite-difference approximation of the classical heat equation, and finally a system of two coupled nonlinear PDEs which form a two-species reaction/diffusion model.  These time-dependent problems are solved by runtime-choosable, and highly controllable, time-stepping methods from a so-far unused major \PETSc object class: \pTS time-steppers.  We will emphasize, and recall the basics of, both \emph{explicit} and \emph{implicit} time-stepping techniques.  And, in the process, we will end up returning to those important scientific computing issues, such as the rapid solution of large systems of equations, in which we have been engaged in previous Chapters.


\section{ODEs and \PETSc \pTS objects}

Consider the ODE in form
\begin{equation}
\by' = \bg(t,\by) \label{eq:ts:ode}
\end{equation}
where $\by(t) \in \RR^N$ and $\by'=\by'(t)$ denotes $d\by/dt$.

FIXME example problem

FIXME intro numerical esp RK and theta \citep{AscherPetzold1998}

FIXME introduce \pTS, which contains \pSNES inside (and thus the rest)

FIXME build all tools around the ``hard'' time dependent case of stiff + nonlinear, though not DAE

FIXME function $\bg$ is \texttt{TSSetRHSFunction()}, Jacobian $\partial \bg/\partial \by$ is \texttt{TSSetRHSJacobian()}

FIXME show \texttt{ode.c}, which is most similar to \texttt{ecjacobian.c}

\cinputpart{ode.c}{\CODELOC}{FIXME}{I}{//CALLBACKS}{//ENDCALLBACKS}{code:ts:ode:callbacks}

\cinputpart{ode.c}{\CODELOC}{FIXME}{II}{//MAIN}{//ENDMAIN}{code:ts:ode:main}

FIXME control \texttt{euler,beuler,cn,theta} by setting steps

FIXME control \texttt{rk} by \texttt{-ts\_type rk -ts\_atol Z -ts\_rk\_type XX}


\section{Time-dependent heat equation}

FIXME solve heat equation by implicit

\cinputpart{heat.c}{\CODELOC}{FIXME}{I}{//HEATCTX}{//ENDHEATCTX}{code:ts:heat:heatctx}

\cinputpart{heat.c}{\CODELOC}{FIXME}{II}{//RHSFUNCTION}{//ENDRHSFUNCTION}{code:ts:heat:rhsfunction}

\cinputpart{heat.c}{\CODELOC}{FIXME}{III}{//RHSJACOBIAN}{//ENDRHSJACOBIAN}{code:ts:heat:rhsjacobian}

\cinputpart{heat.c}{\CODELOC}{FIXME}{IV}{//TSSETUP}{//ENDTSSETUP}{code:ts:heat:tssetup}

\cinputpart{heat.c}{\CODELOC}{FIXME}{V}{//MONITOR}{//ENDMONITOR}{code:ts:heat:monitor}

\begin{figure}
% usage: \standardstack{scale}{objective}{Jacobian}{TS}{DMDA}{DMPlex}
\standardstack{0.775}{dashed}{}{}{}{dashed}
\caption{The \PETSc stack used for the time-dependent heat and reaction/diffusion problems (\texttt{heat.c,pattern.c}).  Compare Figure \ref{fig:of:standardstack}.  FIXME: \pSNES not directly seen by user code}
\label{fig:of:tsstack}
\end{figure}

FIXME show \texttt{-ts\_type theta,beuler,cn}


\section{Coupled reaction-diffusion equations}

FIXME see pages 21--22 of \citep{HundsdorferVerwer2003} and see \citep{Pearson1993}

\cinputpart{pattern.c}{\CODELOC}{FIXME}{I}{//FIELDCTX}{//ENDFIELDCTX}{code:ts:pattern:fieldctx}

\cinputpart{pattern.c}{\CODELOC}{FIXME}{II}{//RHSFUNCTION}{//ENDRHSFUNCTION}{code:ts:pattern:rhsfunction}

\cinputpart{pattern.c}{\CODELOC}{FIXME}{III}{//IFUNCTION}{//ENDIFUNCTION}{code:ts:pattern:ifunction}

\cinputpart{pattern.c}{\CODELOC}{FIXME}{IV}{//IJACOBIAN}{//ENDIJACOBIAN}{code:ts:pattern:ijacobian}

\cinputpart{pattern.c}{\CODELOC}{FIXME}{V}{//TSSETUP}{//ENDTSSETUP}{code:ts:pattern:tssetup}

FIXME show use of \texttt{-ts\_type arkimex,theta}


\section{Exercises}

\renewcommand{\labelenumi}{\arabic{chapter}.\arabic{enumi}\quad}
\renewcommand{\labelenumii}{(\alph{enumii})}
\begin{enumerate}
\item FIXME which \texttt{-ts\_type} work with \texttt{ode.c}?
% euler, beuler, rk, theta, cn
\item FIXME \texttt{ode.c} says it is ``serial only''  what happens with \texttt{mpiexec -n 2 ./ode}, and why?
\item FIXME version of \texttt{ode.c} which solves DAE system
    $$\bbf(t,\by,\by') = \bg(t,\by)$$
where $\partial \bg/\partial \by'$ may be singular
\item FIXME for run like
\begin{cline}
./pattern -da_refine 6 -ptn_tf 500 -ptn_steps 100 -ts_monitor -snes_converged_reason
\end{cline}
which is fastest among these nine ARKIMEX and three $\theta$ methods?:
\begin{code}
-ts_type arkimex -ts_arkimex_type [a2|l2|ars122|2c|2d|2e|3|4|5]
-ts_type theta -ts_theta_endpoint -ts_theta_theta [0.5|0.75|1]
\end{code}
Are any other adaptive \pTS types faster?  Also compare final frames from \texttt{-ts\_monitor\_solution draw}; how worried should we be about the effect of time-stepping on the solution of this problem?
\end{enumerate}
